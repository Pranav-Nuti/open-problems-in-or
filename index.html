<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Open Problems in Operations Research</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header class="site-header">
    <h1 class="site-title"><a href="index.html">Open Problems in Operations Research</a></h1>
  </header>

  <main>
    <div class="wip-warning" role="alert" style="background-color: #fef08a; border: 2px solid #f59e0b; color: #92400e; padding: 1rem 1.5rem; border-radius: 8px;">
      <strong>Work in progress.</strong> All the open problems here are merely LLM generated placeholder text and are potentially nonsensical.
    </div>
    <ul class="problem-list" id="problem-list">
      <!-- Populated by JavaScript -->
    </ul>

    <nav class="pagination" id="pagination" aria-label="Problem list pagination">
      <!-- Populated by JavaScript -->
    </nav>
  </main>

  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-maintainers">Maintainers: Eric Fithian, Rad Niazadeh, Pranav Nuti</div>
      <div>Open Problems in Operations Research</div>
    </div>
  </footer>

  <script>
    const PROBLEMS_PER_PAGE = 10;
    let PROBLEMS_DATA = [];
    let totalPages = 1;

    function getCurrentPage() {
      const params = new URLSearchParams(window.location.search);
      const page = parseInt(params.get('page') || '1', 10);
      return Math.min(Math.max(1, page), totalPages);
    }

    function renderProblems() {
      const currentPage = getCurrentPage();
      const start = (currentPage - 1) * PROBLEMS_PER_PAGE;
      const end = Math.min(start + PROBLEMS_PER_PAGE, PROBLEMS_DATA.length);
      const pageProblems = PROBLEMS_DATA.slice(start, end);

      const listEl = document.getElementById('problem-list');
      listEl.innerHTML = pageProblems.map((p, idx) => `
        <li class="problem-card">
          <a href="problem.html?id=${encodeURIComponent(p.problem_id)}" class="problem-card-link">
            <div class="problem-card-id">Problem #${(currentPage - 1) * PROBLEMS_PER_PAGE + idx + 1}</div>
            <h2 class="problem-card-title">${escapeHtml(p.title)}</h2>
            <div class="problem-card-meta">
              <span>Source: ${formatSourcePaper(p)}</span>
            </div>
          </a>
        </li>
      `).join('');

      renderPagination(currentPage);
    }

    function renderPagination(currentPage) {
      const navEl = document.getElementById('pagination');
      let html = '';

      html += `<a href="?page=${currentPage - 1}" class="${currentPage === 1 ? 'disabled' : ''}" ${currentPage === 1 ? 'aria-disabled="true"' : ''}>Previous</a>`;

      for (let i = 1; i <= totalPages; i++) {
        const activeClass = i === currentPage ? 'current' : '';
        html += `<a href="?page=${i}" class="${activeClass}">${i}</a>`;
      }

      html += `<a href="?page=${currentPage + 1}" class="${currentPage === totalPages ? 'disabled' : ''}" ${currentPage === totalPages ? 'aria-disabled="true"' : ''}>Next</a>`;

      navEl.innerHTML = html;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = String(text ?? "");
      return div.innerHTML;
    }

    function formatSourcePaper(p) {
      const title = escapeHtml(p.source_paper_title || p.source_paper || p.paper_id || "");
      const url = p.source_paper_url || "";
      if (url) {
        return `<a href="${escapeHtml(url)}" target="_blank" rel="noopener">${title}</a>`;
      }
      return title;
    }

    async function loadProblems() {
      const response = await fetch("data/llm_math_export/index.json");
      if (!response.ok) {
        throw new Error(`Failed to load export index: ${response.status}`);
      }
      const payload = await response.json();
      if (!payload || !Array.isArray(payload.problems)) {
        throw new Error("Invalid export index payload.");
      }
      PROBLEMS_DATA = payload.problems;
      totalPages = Math.max(1, Math.ceil(PROBLEMS_DATA.length / PROBLEMS_PER_PAGE));
    }

    async function boot() {
      try {
        await loadProblems();
        renderProblems();
      } catch (err) {
        const listEl = document.getElementById('problem-list');
        listEl.innerHTML = `<li class="problem-card"><div class="problem-card-title">No synced problems found.</div><div class="problem-card-meta">${escapeHtml(err.message)}</div></li>`;
        document.getElementById('pagination').innerHTML = "";
      }
    }

    boot();
  </script>
</body>
</html>
